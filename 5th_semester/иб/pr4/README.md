# Безопасное Web-приложение - Система управления задачами

## Описание

Безопасное web-приложение для управления задачами, реализующее механизмы аутентификации, авторизации и управления доступом на основе ролевой модели. Приложение разработано для практической работы по информационной безопасности.

## Технологический стек

- **Backend**: Node.js + Express
- **База данных**: SQLite (sql.js - чисто JavaScript реализация, не требует компиляции)
- **Криптография**: bcrypt для хеширования паролей, crypto для HMAC
- **Frontend**: Vanilla JavaScript, HTML5, CSS3

## Установка и запуск

1. Установите зависимости:
```bash
npm install
```

2. Запустите сервер:
```bash
npm start
```

3. Откройте браузер и перейдите по адресу:
```
http://localhost:3000
```

## Функциональность

### Аутентификация
- Регистрация новых пользователей
- Вход в систему
- Выход из системы
- Автоматическая проверка сессии

### Авторизация
- Ролевая модель доступа (user, admin)
- Middleware для проверки прав доступа
- Защита маршрутов от неавторизованного доступа

### Управление задачами
- Создание задач
- Просмотр задач
- Редактирование задач
- Удаление задач
- Отметка задач как выполненных
- Административный просмотр всех задач

## Меры безопасности

### 1. Аутентификация

#### Хеширование паролей
- Использование библиотеки `bcrypt` с 10 раундами соли
- Пароли никогда не хранятся в открытом виде
- Защита от timing attacks при проверке паролей

#### Сессии с HMAC
- Собственная реализация сессий с использованием HMAC-SHA256
- Cookie подписываются для предотвращения подделки
- Использование `crypto.timingSafeEqual` для защиты от timing attacks
- Сессии хранятся в базе данных с временем истечения
- Автоматическая очистка устаревших сессий

#### Безопасные Cookie
- Флаг `httpOnly` - защита от XSS атак через JavaScript
- Флаг `sameSite: 'strict'` - защита от CSRF атак
- Ограниченное время жизни (30 минут)
- Автоматическое обновление времени жизни при активности

### 2. Защита от CSRF (Cross-Site Request Forgery)

- Генерация уникальных CSRF токенов для каждой сессии
- Токены хранятся в базе данных
- Проверка токена для всех изменяющих запросов (POST, PUT, DELETE)
- Одноразовые токены (удаляются после использования)
- Токены передаются через заголовок `X-CSRF-Token`

### 3. Защита от SQL Injection

- Использование параметризованных запросов (prepared statements)
- Все пользовательские данные передаются как параметры
- Валидация ID перед использованием в запросах
- Библиотека `better-sqlite3` автоматически экранирует параметры

### 4. Защита от XSS (Cross-Site Scripting)

- Санитизация всех пользовательских данных перед сохранением
- Экранирование HTML символов на клиенте при отображении
- Валидация входных данных (длина, формат)
- Заголовки безопасности (`X-XSS-Protection`, `X-Content-Type-Options`)

### 5. Валидация входных данных

- Проверка формата username (только буквы, цифры, подчёркивание)
- Проверка длины пароля (минимум 6 символов)
- Ограничение длины полей (title: 200 символов, description: 1000 символов)
- Санитизация строк перед сохранением

### 6. Rate Limiting

- Базовая защита от брутфорс атак
- Ограничение количества запросов с одного IP (100 запросов за 15 минут)
- Автоматическая очистка старых записей

### 7. Защита заголовков

- `X-Content-Type-Options: nosniff` - предотвращение MIME-sniffing
- `X-Frame-Options: DENY` - защита от clickjacking
- `X-XSS-Protection: 1; mode=block` - дополнительная защита от XSS
- Удаление заголовка `X-Powered-By` для сокрытия информации о сервере

### 8. Защита от кражи Cookie

- Использование `sameSite: 'strict'` предотвращает отправку cookie при cross-site запросах
- HttpOnly флаг предотвращает доступ к cookie через JavaScript
- Ограниченное время жизни сессий
- Автоматическое удаление сессий при выходе

### 9. Ролевая модель доступа

- Middleware для проверки ролей пользователей
- Разделение прав доступа между обычными пользователями и администраторами
- Проверка прав на уровне маршрутов

## Структура проекта

```
.
├── server.js              # Главный файл сервера
├── database.js             # Инициализация и работа с БД
├── package.json            # Зависимости проекта
├── routes/
│   ├── auth.js            # Маршруты аутентификации
│   └── tasks.js           # Маршруты для работы с задачами
├── security/
│   ├── session.js         # Управление сессиями и HMAC
│   ├── csrf.js            # CSRF защита
│   └── validation.js      # Валидация и санитизация данных
└── public/
    ├── index.html         # Главная страница
    ├── styles.css         # Стили
    └── app.js             # Клиентский JavaScript
```

## API Endpoints

### Аутентификация

- `POST /api/auth/register` - Регистрация нового пользователя
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/logout` - Выход из системы
- `GET /api/auth/me` - Получение информации о текущем пользователе
- `GET /api/auth/csrf-token` - Получение CSRF токена

### Задачи

- `GET /api/tasks` - Получение всех задач текущего пользователя
- `GET /api/tasks/:id` - Получение задачи по ID
- `POST /api/tasks` - Создание новой задачи
- `PUT /api/tasks/:id` - Обновление задачи
- `DELETE /api/tasks/:id` - Удаление задачи
- `GET /api/tasks/admin/all` - Получение всех задач (только для администраторов)

## Роли пользователей

- **user** - Обычный пользователь, может управлять только своими задачами
- **admin** - Администратор, может просматривать все задачи всех пользователей

## Примечания

- В продакшене необходимо:
  - Использовать HTTPS (установить `secure: true` для cookie)
  - Хранить секретные ключи в переменных окружения
  - Настроить более продвинутый rate limiting
  - Использовать более сложную систему логирования
  - Регулярно обновлять зависимости

## Лицензия

ISC

